import threading
import cv2
import ProcessRawData as prd
import numpy as np
import matplotlib.pyplot as pt
import pandas as pd
from sklearn import ensemble
import time




def init():
    data = prd.doMagic()
    data = prep_array(data, 28)
    return data

def prepare_dataset():
    train = pd.read_csv("D:\Python\datasets\emnist\emnist-letters-train.csv").as_matrix()
    test = pd.read_csv("D:\Python\datasets\emnist\emnist-letters-test.csv").as_matrix()
    train_x, train_y = list(), list()
    for i in range(0, len(train[:10000])):
        train_x.append(train[i][1:])
        train_y.append(train[i][0])

    test_x, test_y = list(), list()
    for i in range(0, len(test[:10000])):
        test_x.append(train[i][1:])
        test_y.append(train[i][0])

    #data = list(train_x, train_y , test_x, test_y)
    return train_x, train_y #, test_x, test_y


def predict():
    img = init()
    img = np.array(img)
    img = np.reshape(img, -1, 1)

    a = np.array([img])
    # a = np.array([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,9,32,37,39,82,124,77,8,0,0,0,0,0,0,0,0,0,0,0,0,0,2,9,32,37,37,39,82,139,204,215,217,233,249,218,90,7,0,0,0,0,0,2,4,4,4,5,21,34,82,139,204,217,217,217,233,250,254,254,254,254,255,253,200,32,0,0,0,0,7,76,125,127,127,129,172,204,233,250,254,254,254,254,254,254,250,250,250,252,254,252,172,21,0,0,0,0,19,151,215,217,217,217,233,245,252,254,254,254,252,250,250,245,222,217,217,236,254,250,139,9,0,0,0,0,20,168,249,254,254,254,254,252,245,222,217,215,172,129,127,114,51,39,41,146,249,218,77,2,0,0,0,0,2,67,170,215,217,217,204,172,115,51,37,37,21,5,4,4,0,0,9,135,203,90,8,0,0,0,0,0,0,2,21,37,37,37,32,21,4,0,0,0,0,0,0,0,0,0,27,145,58,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,26,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]])
    # a = np.reshape(a, -1, 1)

    start_time = time.time()
    train_x, train_y = prepare_dataset()
    print("Time 1 : " + str(time.time()-start_time))

    start_time = time.time()
    classifier = ensemble.RandomForestClassifier()
    classifier.fit(train_x, train_y)
    print("Time 2 : " + str(time.time()-start_time))

    start_time = time.time()
    result = classifier.predict(a)
    print(">> Result : " + str(result))
    print("Time 3 : " + str(time.time()-start_time))


def prep_array(arr, num):
    l = list()
    for i in range(0,num):
        for j in range(0, num):
                l.append(arr[i][j])

    return l


if __name__ == "__main__":
    predict()
    #a = init()
    # temp = prep_array(temp, 28)
    # a = np.array([1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,4,2,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,9,32,37,39,82,124,77,8,0,0,0,0,0,0,0,0,0,0,0,0,0,2,9,32,37,37,39,82,139,204,215,217,233,249,218,90,7,0,0,0,0,0,2,4,4,4,5,21,34,82,139,204,217,217,217,233,250,254,254,254,254,255,253,200,32,0,0,0,0,7,76,125,127,127,129,172,204,233,250,254,254,254,254,254,254,250,250,250,252,254,252,172,21,0,0,0,0,19,151,215,217,217,217,233,245,252,254,254,254,252,250,250,245,222,217,217,236,254,250,139,9,0,0,0,0,20,168,249,254,254,254,254,252,245,222,217,215,172,129,127,114,51,39,41,146,249,218,77,2,0,0,0,0,2,67,170,215,217,217,204,172,115,51,37,37,21,5,4,4,0,0,9,135,203,90,8,0,0,0,0,0,0,2,21,37,37,37,32,21,4,0,0,0,0,0,0,0,0,0,27,145,58,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5,26,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])
    # # a = np.array([[1, 2, 3], [4, 5, 6]])
    # a = np.reshape(a, -1, 1)
    # print(len(a))
